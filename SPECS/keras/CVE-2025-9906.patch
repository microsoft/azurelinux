From cb5f102e1c4767716e9b2b3a0b76f4d1b8f8d4b5 Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Mon, 22 Sep 2025 06:05:26 +0000
Subject: [PATCH] Backport original.patch: extend get_attr_skiplist to include
 Operation, Cross, Feature and lazy imports; align with KerasSaveable-only
 deserialization policy

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/keras-team/keras/pull/21429.patch
---
 keras/src/saving/saving_lib.py | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/keras/src/saving/saving_lib.py b/keras/src/saving/saving_lib.py
index e71e33b..94b9561 100644
--- a/keras/src/saving/saving_lib.py
+++ b/keras/src/saving/saving_lib.py
@@ -772,7 +772,7 @@ def get_attr_skiplist(obj_type):
         from keras.src.ops.operation import Operation
 
         ref_obj = Operation()
-        skipset.update(dir(ref_obj))
+        skiplist += dir(ref_obj)
     if obj_type == "Layer":
         from keras.src.layers.layer import Layer
 
@@ -810,12 +810,12 @@ def get_attr_skiplist(obj_type):
         from keras.src.layers.preprocessing.feature_space import Cross
 
         ref_obj = Cross((), 1)
-        skipset.update(dir(ref_obj))
+        skiplist += dir(ref_obj)
     elif obj_type == "Feature":
         from keras.src.layers.preprocessing.feature_space import Feature
 
         ref_obj = Feature("int32", lambda x: x, "int")
-        skipset.update(dir(ref_obj))
+        skiplist += dir(ref_obj)
     else:
         raise ValueError(
             f"get_attr_skiplist got invalid {obj_type=}. "
-- 
2.45.4

