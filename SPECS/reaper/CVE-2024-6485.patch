From 769c032fd93d6f2c07599e096a736c5d09c041cf Mon Sep 17 00:00:00 2001
From: Klemen <16374228+KlemenDEV@users.noreply.github.com>
Date: Tue, 1 Oct 2024 17:50:16 +0200
Subject: [PATCH] Fix CVE-2024-6485 (#2) by KlemenDEV

* Fix CVE-2024-6485

* Inline

* Remove comment

Upstream Patch Reference: https://github.com/entreprise7pro/bootstrap/commit/769c032fd93d6f2c07599e096a736c5d09c041cf.patch
---
 src/ui/bower_components/bootstrap/js/button.js | 11 ++++++++++-
 src/ui/node_modules/bootstrap/js/button.js     | 11 ++++++++++-
 src/ui/theming/bootstrap/js/button.js          | 11 ++++++++++-
 3 files changed, 30 insertions(+), 3 deletions(-)

diff --git a/src/ui/bower_components/bootstrap/js/button.js b/src/ui/bower_components/bootstrap/js/button.js
index 843b39c9..f84d4e2d 100644
--- a/src/ui/bower_components/bootstrap/js/button.js
+++ b/src/ui/bower_components/bootstrap/js/button.js
@@ -25,6 +25,15 @@
     loadingText: 'loading...'
   }
 
+  Button.prototype.sanitize = function (unsafeText) {
+    return unsafeText
+      .replace(/&/g, "&amp;")
+      .replace(/</g, "&lt;")
+      .replace(/>/g, "&gt;")
+      .replace(/"/g, "&quot;")
+      .replace(/'/g, "&#039;");
+  }
+
   Button.prototype.setState = function (state) {
     var d    = 'disabled'
     var $el  = this.$element
@@ -37,7 +46,7 @@
 
     // push to event loop to allow forms to submit
     setTimeout($.proxy(function () {
-      $el[val](data[state] == null ? this.options[state] : data[state])
+      $el[val](data[state] == null ? this.options[state] : this.sanitize(data[state]))
 
       if (state == 'loadingText') {
         this.isLoading = true
diff --git a/src/ui/node_modules/bootstrap/js/button.js b/src/ui/node_modules/bootstrap/js/button.js
index ff4af20e..1c9defa7 100644
--- a/src/ui/node_modules/bootstrap/js/button.js
+++ b/src/ui/node_modules/bootstrap/js/button.js
@@ -25,6 +25,15 @@
     loadingText: 'loading...'
   }
 
+  Button.prototype.sanitize = function (unsafeText) {
+    return unsafeText
+      .replace(/&/g, "&amp;")
+      .replace(/</g, "&lt;")
+      .replace(/>/g, "&gt;")
+      .replace(/"/g, "&quot;")
+      .replace(/'/g, "&#039;");
+  }
+
   Button.prototype.setState = function (state) {
     var d    = 'disabled'
     var $el  = this.$element
@@ -37,7 +46,7 @@
 
     // push to event loop to allow forms to submit
     setTimeout($.proxy(function () {
-      $el[val](data[state] == null ? this.options[state] : data[state])
+      $el[val](data[state] == null ? this.options[state] : this.sanitize(data[state]))
 
       if (state == 'loadingText') {
         this.isLoading = true
diff --git a/src/ui/theming/bootstrap/js/button.js b/src/ui/theming/bootstrap/js/button.js
index 8fdf9ddc..b9244470 100644
--- a/src/ui/theming/bootstrap/js/button.js
+++ b/src/ui/theming/bootstrap/js/button.js
@@ -25,6 +25,15 @@
     loadingText: 'loading...'
   }
 
+  Button.prototype.sanitize = function (unsafeText) {
+    return unsafeText
+      .replace(/&/g, "&amp;")
+      .replace(/</g, "&lt;")
+      .replace(/>/g, "&gt;")
+      .replace(/"/g, "&quot;")
+      .replace(/'/g, "&#039;");
+  }
+
   Button.prototype.setState = function (state) {
     var d    = 'disabled'
     var $el  = this.$element
@@ -37,7 +46,7 @@
 
     // push to event loop to allow forms to submit
     setTimeout($.proxy(function () {
-      $el[val](data[state] == null ? this.options[state] : data[state])
+      $el[val](data[state] == null ? this.options[state] : this.sanitize(data[state]))
 
       if (state == 'loadingText') {
         this.isLoading = true
-- 
2.43.0

