From 3f645278975dce604c9025c1b0a3271279a3b6df Mon Sep 17 00:00:00 2001
From: Preston Vasquez <prestonvasquez@icloud.com>
Date: Mon, 26 Jan 2026 09:48:19 -0700
Subject: [PATCH] =?UTF-8?q?GODRIVER-3770=20Fix=20buffer=20handling=20in=20?=
 =?UTF-8?q?GSSAPI=20error=20description=20and=20use=E2=80=A6=20(#2304)?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: https://github.com/mongodb/mongo-go-driver/commit/76ec2daba15f743989040ce2fdaf83f4a3e69bcb.patch
---
 .../x/mongo/driver/auth/internal/gssapi/gss_wrapper.c     | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/vendor/go.mongodb.org/mongo-driver/x/mongo/driver/auth/internal/gssapi/gss_wrapper.c b/vendor/go.mongodb.org/mongo-driver/x/mongo/driver/auth/internal/gssapi/gss_wrapper.c
index 68b72541..e426037e 100644
--- a/vendor/go.mongodb.org/mongo-driver/x/mongo/driver/auth/internal/gssapi/gss_wrapper.c
+++ b/vendor/go.mongodb.org/mongo-driver/x/mongo/driver/auth/internal/gssapi/gss_wrapper.c
@@ -72,8 +72,8 @@ int gssapi_error_desc(
             free(*desc);
         }
 
-        *desc = malloc(desc_buffer.length+1);
-        memcpy(*desc, desc_buffer.value, desc_buffer.length+1);
+        *desc = calloc(1, desc_buffer.length + 1);
+        memcpy(*desc, desc_buffer.value, desc_buffer.length);
 
         gss_release_buffer(&local_min_stat, &desc_buffer);
     }
@@ -144,8 +144,8 @@ int gssapi_client_username(
         return GSSAPI_ERROR;
     }
 
-	*username = malloc(name_buffer.length+1);
-	memcpy(*username, name_buffer.value, name_buffer.length+1);
+    *username = calloc(1, name_buffer.length + 1);
+    memcpy(*username, name_buffer.value, name_buffer.length);
 
     gss_release_buffer(&ignored, &name_buffer);
     gss_release_name(&ignored, &name);
-- 
2.45.4

