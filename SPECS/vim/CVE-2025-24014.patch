From a37c69c15cc3ea6b2e67336748a578d2c2c549db Mon Sep 17 00:00:00 2001
From: jykanase <v-jykanase@microsoft.com>
Date: Thu, 23 Jan 2025 09:19:12 +0000
Subject: [PATCH] CVE-CVE-2025-24014

Source Link : https://github.com/vim/vim/commit/9d1bed5eccdbb46a26b8a484f5e9163c40e63919
---
 src/gui.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/gui.c b/src/gui.c
index 8e7b079..86c40de 100644
--- a/src/gui.c
+++ b/src/gui.c
@@ -4478,13 +4478,15 @@ gui_do_scroll(void)
     /*
      * Don't call updateWindow() when nothing has changed (it will overwrite
      * the status line!).
+     *
+     * Check for ScreenLines, because in ex-mode, we don't have a valid display.
      */
-    if (old_topline != wp->w_topline
+    if (ScreenLines != NULL && (old_topline != wp->w_topline
	    || wp->w_redr_type != 0
 #ifdef FEAT_DIFF
	    || old_topfill != wp->w_topfill
 #endif
-	    )
+	    ))
     {
	int type = UPD_VALID;

--
2.45.2

