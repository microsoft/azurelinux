From 1920c4717fbf6110a1ca47614d9ac33f3555a0cb Mon Sep 17 00:00:00 2001
From: archana25-ms <v-shettigara@microsoft.com>
Date: Wed, 12 Mar 2025 09:01:05 +0000
Subject: [PATCH] Address CVE-2012-3425

Source link: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=668082#15

---
 com32/lib/libpng/pngpread.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/com32/lib/libpng/pngpread.c b/com32/lib/libpng/pngpread.c
index d066944..01e0f96 100644
--- a/com32/lib/libpng/pngpread.c
+++ b/com32/lib/libpng/pngpread.c
@@ -1380,6 +1380,13 @@ png_push_read_zTXt(png_structp png_ptr, png_infop info_ptr)
 
       text++;
 
+      if (text >= key + png_ptr->current_text_size)
+      {
+         png_ptr->current_text = NULL;
+         png_free(png_ptr, key);
+         return;
+      }
+
       if (*text != PNG_TEXT_COMPRESSION_zTXt) /* Check compression byte */
       {
          png_ptr->current_text = NULL;
-- 
2.45.3

