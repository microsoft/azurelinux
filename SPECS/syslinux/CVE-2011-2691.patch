From 8641c8a598a4ae91eac69b7af05607ba1236ae78 Mon Sep 17 00:00:00 2001
From: archana25-ms <v-shettigara@microsoft.com>
Date: Wed, 12 Mar 2025 08:54:38 +0000
Subject: [PATCH] Address CVE-2011-2691

Source link: https://sourceforge.net/p/libpng/code/ci/9dad5e37aef295b4ef8dea39392b652deebc9261

---
 com32/lib/libpng/pngerror.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/com32/lib/libpng/pngerror.c b/com32/lib/libpng/pngerror.c
index 0a99df8..dd50507 100644
--- a/com32/lib/libpng/pngerror.c
+++ b/com32/lib/libpng/pngerror.c
@@ -87,12 +87,17 @@ png_error(png_structp png_ptr, png_const_charp error_message)
 void PNGAPI
 png_err(png_structp png_ptr)
 {
+   /* Prior to 1.4.8 the error_fn received a NULL pointer, expressed
+    * erroneously as '\0', instead of the empty string "".  This was
+    * apparently an error, introduced in libpng-1.2.20, and png_default_error
+    * will crash in this case.
+    */
    if (png_ptr != NULL && png_ptr->error_fn != NULL)
-      (*(png_ptr->error_fn))(png_ptr, '\0');
+      (*(png_ptr->error_fn))(png_ptr, "");
 
    /* If the custom handler doesn't exist, or if it returns,
       use the default handler, which will not return. */
-   png_default_error(png_ptr, '\0');
+   png_default_error(png_ptr, "");
 }
 #endif /* PNG_ERROR_TEXT_SUPPORTED */
 
-- 
2.45.3

