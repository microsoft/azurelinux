From 4b8822c47d7aeda5e1a1865e634112caa71c5004 Mon Sep 17 00:00:00 2001
From: archana25-ms <v-shettigara@microsoft.com>
Date: Wed, 12 Mar 2025 06:56:17 +0000
Subject: [PATCH] Address CVE-2011-2501

Source link: https://sourceforge.net/p/libpng/code/ci/65e6d5a34f49acdb362a0625a706c6b914e670af

---
 com32/lib/libpng/pngerror.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/com32/lib/libpng/pngerror.c b/com32/lib/libpng/pngerror.c
index 7bc98fb..0a99df8 100644
--- a/com32/lib/libpng/pngerror.c
+++ b/com32/lib/libpng/pngerror.c
@@ -181,8 +181,13 @@ png_format_buffer(png_structp png_ptr, png_charp buffer, png_const_charp
    {
       buffer[iout++] = ':';
       buffer[iout++] = ' ';
-      png_memcpy(buffer + iout, error_message, PNG_MAX_ERROR_TEXT);
-      buffer[iout + PNG_MAX_ERROR_TEXT - 1] = '\0';
+
+      iin = 0;
+      while (iin < PNG_MAX_ERROR_TEXT-1 && error_message[iin] != '\0')
+         buffer[iout++] = error_message[iin++];
+
+      /* iin < PNG_MAX_ERROR_TEXT, so the following is safe: */
+      buffer[iout] = '\0';
    }
 }
 
-- 
2.45.3

