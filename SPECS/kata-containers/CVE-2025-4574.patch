From 083d6622dcdf0a3d3283e22d0bebcd363cf197a0 Mon Sep 17 00:00:00 2001
From: Sreenivasulu Malavathula <v-smalavathu@microsoft.com>
Date: Tue, 20 May 2025 19:31:47 -0500
Subject: [PATCH] Address CVE-2025-4574
Upstream Patch Reference: https://github.com/crossbeam-rs/crossbeam/pull/1187/commits/ca3fc0dfaa51eae914bdd8bb88b34bce3561709e

---
 src/agent/vendor/crossbeam-channel/src/flavors/list.rs | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/agent/vendor/crossbeam-channel/src/flavors/list.rs b/src/agent/vendor/crossbeam-channel/src/flavors/list.rs
index 6c15991f..8f1faaa8 100644
--- a/src/agent/vendor/crossbeam-channel/src/flavors/list.rs
+++ b/src/agent/vendor/crossbeam-channel/src/flavors/list.rs
@@ -611,7 +611,7 @@ impl<T> Channel<T> {
             // In that case, just wait until it gets initialized.
             while block.is_null() {
                 backoff.snooze();
-                block = self.head.block.load(Ordering::Acquire);
+                block = self.head.block.swap(ptr::null_mut(), Ordering::AcqRel);
             }
         }
 
-- 
2.45.2

