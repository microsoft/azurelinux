From 9c8487d3b1aa90b6bd801bdda1b9843159088aaf Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Thu, 17 Jul 2025 08:42:47 +0000
Subject: [PATCH] Fix CVE CVE-2024-25178 in sysbench

Upstream Patch Reference: https://github.com/LuaJIT/LuaJIT/commit/defe61a56751a0db5f00ff3ab7b8f45436ba74c8.patch
---
 third_party/luajit/luajit/src/lj_debug.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/third_party/luajit/luajit/src/lj_debug.c b/third_party/luajit/luajit/src/lj_debug.c
index 8319fa1..fc1f15a 100644
--- a/third_party/luajit/luajit/src/lj_debug.c
+++ b/third_party/luajit/luajit/src/lj_debug.c
@@ -63,6 +63,7 @@ static BCPos debug_framepc(lua_State *L, GCfunc *fn, cTValue *nextframe)
     if (cf == NULL || (char *)cframe_pc(cf) == (char *)cframe_L(cf))
       return NO_BCPOS;
     ins = cframe_pc(cf);  /* Only happens during error/hook handling. */
+    if (!ins) return NO_BCPOS;
   } else {
     if (frame_islua(nextframe)) {
       ins = frame_pc(nextframe);
-- 
2.45.3

