From 6d48b3888b46553d021d3d43e5cbbd86a5fa0a94 Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Thu, 17 Jul 2025 08:42:39 +0000
Subject: [PATCH] Fix CVE CVE-2024-25176 in sysbench

Upstream Patch Reference: https://github.com/LuaJIT/LuaJIT/commit/343ce0edaf3906a62022936175b2f5410024cbfc.patch
---
 third_party/luajit/luajit/src/lj_strfmt_num.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/third_party/luajit/luajit/src/lj_strfmt_num.c b/third_party/luajit/luajit/src/lj_strfmt_num.c
index 9271f68..1d4fc7c 100644
--- a/third_party/luajit/luajit/src/lj_strfmt_num.c
+++ b/third_party/luajit/luajit/src/lj_strfmt_num.c
@@ -454,7 +454,8 @@ static char *lj_strfmt_wfnum(SBuf *sb, SFormat sf, lua_Number n, char *p)
 	    prec--;
 	    if (!i) {
 	      if (ndlo == ndhi) { prec = 0; break; }
-	      lj_strfmt_wuint9(tail, nd[++ndlo]);
+	      ndlo = (ndlo + 1) & 0x3f;
+	      lj_strfmt_wuint9(tail, nd[ndlo]);
 	      i = 9;
 	    }
 	  }
-- 
2.45.3

