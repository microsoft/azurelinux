From 49d96b44fbc27ecca525bd99b79f39b373669a96 Mon Sep 17 00:00:00 2001
From: Sreenivasulu Malavathula <v-smalavathu@microsoft.com>
Date: Thu, 12 Jun 2025 12:02.08 -0500
Subject: [PATCH] Address CVE-2023-45803
Upstream Patch Reference: https://github.com/urllib3/urllib3/commit/4e98d57809dacab1cbe625fddeec1a290c478ea9

---
 .../pip/_vendor/urllib3/connectionpool.py     |  5 +++++
 1 file changed, 30 insertions(+), 2 deletions(-)

diff --git a/pip/_vendor/urllib3/connectionpool.py b/pip/_vendor/urllib3/connectionpool.py
index 7087392..c701f78 100644
--- a/pip/_vendor/urllib3/connectionpool.py
+++ b/pip/_vendor/urllib3/connectionpool.py
@@ -8,6 +8,7 @@ import sys
 import warnings
 from socket import error as SocketError
 from socket import timeout as SocketTimeout
+from ._collections import HTTPHeaderDict
 
 from .connection import (
     BaseSSLError,
@@ -832,7 +833,11 @@ class HTTPConnectionPool(ConnectionPool, RequestMethods):
         redirect_location = redirect and response.get_redirect_location()
         if redirect_location:
             if response.status == 303:
+                # Change the method according to RFC 9110, Section 15.4.4.
                 method = "GET"
+                # And lose the body not to transfer anything sensitive.
+                body = None
+                headers = HTTPHeaderDict(headers)._prepare_for_method_change()
 
             try:
                 retries = retries.increment(method, url, response=response, _pool=self)
-- 
2.45.2

