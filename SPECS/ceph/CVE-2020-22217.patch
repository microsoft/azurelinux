From 97568ddb836a9680c93335a3f8ca0f2c0616ccdc Mon Sep 17 00:00:00 2001
From: Kevin Lockwood <v-klockwood@microsoft.com>
Date: Mon, 27 Jan 2025 16:19:53 -0800
Subject: [PATCH] Fix CVE-2020-22217 in c-ares

Link: https://github.com/c-ares/c-ares/pull/332
---
 src/c-ares/ares_parse_soa_reply.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/c-ares/ares_parse_soa_reply.c b/src/c-ares/ares_parse_soa_reply.c
index 35af0a75c..5924bbca9 100644
--- a/src/c-ares/ares_parse_soa_reply.c
+++ b/src/c-ares/ares_parse_soa_reply.c
@@ -65,6 +65,9 @@ ares_parse_soa_reply(const unsigned char *abuf, int alen,
   status = ares__expand_name_for_response(aptr, abuf, alen, &qname, &len);
   if (status != ARES_SUCCESS)
     goto failed_stat;
+
+  if (alen <= len + HFIXEDSZ + 1)
+    goto failed;
   aptr += len;
 
   /* skip qtype & qclass */
-- 
2.34.1

