From 73e1e5635f27e444abd0bf3ce2144c7378e29401 Mon Sep 17 00:00:00 2001
From: Kevin Lockwood <v-klockwood@microsoft.com>
Date: Tue, 4 Feb 2025 15:04:56 -0800
Subject: [PATCH] [Medium] Patch ceph to fix CVE-2020-10722

Link: https://git.dpdk.org/dpdk/patch/?id=3ae4beb079ce242240c34376a066bbccd0c0b23e
---
 src/seastar/dpdk/lib/librte_vhost/vhost_user.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/seastar/dpdk/lib/librte_vhost/vhost_user.c b/src/seastar/dpdk/lib/librte_vhost/vhost_user.c
index c9e29ece8..91fb802ba 100644
--- a/src/seastar/dpdk/lib/librte_vhost/vhost_user.c
+++ b/src/seastar/dpdk/lib/librte_vhost/vhost_user.c
@@ -1434,10 +1434,10 @@ vhost_user_set_log_base(struct virtio_net **pdev, struct VhostUserMsg *msg,
 	size = msg->payload.log.mmap_size;
 	off  = msg->payload.log.mmap_offset;
 
-	/* Don't allow mmap_offset to point outside the mmap region */
-	if (off > size) {
++	/* Check for mmap size and offset overflow. */
++	if (off >= -size) {
 		RTE_LOG(ERR, VHOST_CONFIG,
-			"log offset %#"PRIx64" exceeds log size %#"PRIx64"\n",
++			"log offset %#"PRIx64" and log size %#"PRIx64" overflow\n",
 			off, size);
 		return RTE_VHOST_MSG_RESULT_ERR;
 	}
-- 
2.34.1

