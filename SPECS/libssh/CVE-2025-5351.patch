From 5f21b769c263f77db24b7a2757a7394608e3c4a4 Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Thu, 10 Jul 2025 14:07:05 +0000
Subject: [PATCH] Fix CVE CVE-2025-5351 in libssh

Upstream Patch Reference: https://git.libssh.org/projects/libssh.git/patch/?id=6ddb730a27338983851248af59b128b995aad256
---
 src/pki_crypto.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/pki_crypto.c b/src/pki_crypto.c
index 5b0d7de..aec4954 100644
--- a/src/pki_crypto.c
+++ b/src/pki_crypto.c
@@ -2023,6 +2023,7 @@ ssh_string pki_publickey_to_blob(const ssh_key key)
             bignum_safe_free(bn);
             bignum_safe_free(be);
             OSSL_PARAM_free(params);
+            params = NULL;
 #endif /* OPENSSL_VERSION_NUMBER */
             break;
         }
@@ -2143,6 +2144,7 @@ ssh_string pki_publickey_to_blob(const ssh_key key)
  */
 #if 0
                 OSSL_PARAM_free(params);
+                params = NULL;
 #endif /* OPENSSL_VERSION_NUMBER */
 
                 if (key->type == SSH_KEYTYPE_SK_ECDSA &&
-- 
2.45.3

