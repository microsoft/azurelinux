From e6fa2c1c12edb30568f15af3891ec7607964968f Mon Sep 17 00:00:00 2001
From: Kevin Lockwood <v-klockwood@microsoft.com>
Date: Wed, 26 Feb 2025 14:03:35 -0800
Subject: [PATCH] Patch llvm16 for CVE-2023-29941 [Medium]

Link: https://github.com/llvm/llvm-project/commit/9a29d87538842a29b430c6956a4f914896643691.patch
---
 .../Dialect/SparseTensor/Transforms/SparseBufferRewriting.cpp  | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/mlir/lib/Dialect/SparseTensor/Transforms/SparseBufferRewriting.cpp b/mlir/lib/Dialect/SparseTensor/Transforms/SparseBufferRewriting.cpp
index fc9476cd2..2db37a1e4 100644
--- a/mlir/lib/Dialect/SparseTensor/Transforms/SparseBufferRewriting.cpp
+++ b/mlir/lib/Dialect/SparseTensor/Transforms/SparseBufferRewriting.cpp
@@ -728,6 +728,9 @@ LogicalResult matchAndRewriteSortOp(OpTy op, ValueRange xys, uint64_t nx,
     operands.push_back(v);
   }
   auto insertPoint = op->template getParentOfType<func::FuncOp>();
+  if (!insertPoint)
+    return failure();
+
   SmallString<32> funcName(op.getStable() ? kSortStableFuncNamePrefix
                                           : kSortNonstableFuncNamePrefix);
   FuncGeneratorType funcGenerator =
-- 
2.34.1

