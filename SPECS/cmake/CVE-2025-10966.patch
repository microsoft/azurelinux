From ba01c30309f53c35d19685aeb42c9110270901c1 Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Thu, 22 Jan 2026 05:44:33 +0000
Subject: [PATCH] vssh: drop support for wolfSSH; remove wolfssh backend, build
 flags, workflow references aligning with upstream patch

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/curl/curl/commit/b011e3fcfb06d6c0278595ee2ee297036fbe9793.patch
---
 Utilities/cmcurl/lib/Makefile.inc |  3 +--
 Utilities/cmcurl/lib/curl_setup.h |  2 +-
 Utilities/cmcurl/lib/easy.c       | 11 ++---------
 Utilities/cmcurl/lib/url.c        |  2 +-
 Utilities/cmcurl/lib/version.c    |  4 +---
 Utilities/cmcurl/lib/vssh/ssh.h   |  9 ---------
 6 files changed, 6 insertions(+), 25 deletions(-)

diff --git a/Utilities/cmcurl/lib/Makefile.inc b/Utilities/cmcurl/lib/Makefile.inc
index 3e9ddec1..5bb8dac0 100644
--- a/Utilities/cmcurl/lib/Makefile.inc
+++ b/Utilities/cmcurl/lib/Makefile.inc
@@ -85,8 +85,7 @@ LIB_VQUIC_HFILES = \
 
 LIB_VSSH_CFILES =  \
   vssh/libssh.c    \
-  vssh/libssh2.c   \
-  vssh/wolfssh.c
+  vssh/libssh2.c
 
 LIB_VSSH_HFILES =  \
   vssh/ssh.h
diff --git a/Utilities/cmcurl/lib/curl_setup.h b/Utilities/cmcurl/lib/curl_setup.h
index 2d13a40a..7ce70504 100644
--- a/Utilities/cmcurl/lib/curl_setup.h
+++ b/Utilities/cmcurl/lib/curl_setup.h
@@ -683,7 +683,7 @@ int netware_init(void);
 #error "No longer supported. Set CURLOPT_CAINFO at runtime instead."
 #endif
 
-#if defined(USE_LIBSSH2) || defined(USE_LIBSSH) || defined(USE_WOLFSSH)
+#if defined(USE_LIBSSH2) || defined(USE_LIBSSH)
 #define USE_SSH
 #endif
 
diff --git a/Utilities/cmcurl/lib/easy.c b/Utilities/cmcurl/lib/easy.c
index 1303b61a..96ec299b 100644
--- a/Utilities/cmcurl/lib/easy.c
+++ b/Utilities/cmcurl/lib/easy.c
@@ -185,12 +185,7 @@ static CURLcode global_init(long flags, bool memoryfuncs)
   }
 #endif
 
-#ifdef USE_WOLFSSH
-  if(WS_SUCCESS != wolfSSH_Init()) {
-    DEBUGF(fprintf(stderr, "Error: wolfSSH_Init failed\n"));
-    return CURLE_FAILED_INIT;
-  }
-#endif
+/* wolfSSH backend removed */
 
   init_flags = flags;
 
@@ -272,9 +267,7 @@ void curl_global_cleanup(void)
 
   Curl_ssh_cleanup();
 
-#ifdef USE_WOLFSSH
-  (void)wolfSSH_Cleanup();
-#endif
+/* wolfSSH backend removed */
 #ifdef DEBUGBUILD
   free(leakpointer);
 #endif
diff --git a/Utilities/cmcurl/lib/url.c b/Utilities/cmcurl/lib/url.c
index 8eaa0605..c1ca6fce 100644
--- a/Utilities/cmcurl/lib/url.c
+++ b/Utilities/cmcurl/lib/url.c
@@ -191,7 +191,7 @@ static const struct Curl_handler * const protocols[] = {
   &Curl_handler_file,
 #endif
 
-#if defined(USE_SSH) && !defined(USE_WOLFSSH)
+#if defined(USE_SSH)
   &Curl_handler_scp,
 #endif
 
diff --git a/Utilities/cmcurl/lib/version.c b/Utilities/cmcurl/lib/version.c
index b67b9a46..48035b58 100644
--- a/Utilities/cmcurl/lib/version.c
+++ b/Utilities/cmcurl/lib/version.c
@@ -356,10 +356,8 @@ static const char * const protocols[] = {
 #ifndef CURL_DISABLE_RTSP
   "rtsp",
 #endif
-#if defined(USE_SSH) && !defined(USE_WOLFSSH)
-  "scp",
-#endif
 #ifdef USE_SSH
+  "scp",
   "sftp",
 #endif
 #if !defined(CURL_DISABLE_SMB) && defined(USE_CURL_NTLM_CORE) && \
diff --git a/Utilities/cmcurl/lib/vssh/ssh.h b/Utilities/cmcurl/lib/vssh/ssh.h
index 505b0787..e04fb861 100644
--- a/Utilities/cmcurl/lib/vssh/ssh.h
+++ b/Utilities/cmcurl/lib/vssh/ssh.h
@@ -30,9 +30,6 @@
 #elif defined(HAVE_LIBSSH_LIBSSH_H)
 #include <libssh/libssh.h>
 #include <libssh/sftp.h>
-#elif defined(USE_WOLFSSH)
-#include <wolfssh/ssh.h>
-#include <wolfssh/wolfsftp.h>
 #endif
 
 /****************************************************************************
@@ -200,12 +197,6 @@ struct ssh_conn {
 #ifdef HAVE_LIBSSH2_KNOWNHOST_API
   LIBSSH2_KNOWNHOSTS *kh;
 #endif
-#elif defined(USE_WOLFSSH)
-  WOLFSSH *ssh_session;
-  WOLFSSH_CTX *ctx;
-  word32 handleSz;
-  byte handle[WOLFSSH_MAX_HANDLE];
-  curl_off_t offset;
 #endif /* USE_LIBSSH */
 };
 
-- 
2.45.4

