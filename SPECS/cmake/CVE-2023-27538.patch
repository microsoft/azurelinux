From 89e90fece52aa6abbf96ac84477ea82d9c12a6ef Mon Sep 17 00:00:00 2001
From: Sharath Srikanth Chellappa <sharathsr@microsoft.com>
Date: Wed, 13 Nov 2024 13:29:57 -0800
Subject: [PATCH] Patch for CVE-2023-27538

Upstream Patch: https://github.com/curl/curl/commit/af369db4d3833272b8ed

---
 Utilities/cmcurl/lib/url.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/Utilities/cmcurl/lib/url.c b/Utilities/cmcurl/lib/url.c
index 4ab389af48..ca40322504 100644
--- a/Utilities/cmcurl/lib/url.c
+++ b/Utilities/cmcurl/lib/url.c
@@ -1334,6 +1334,11 @@ ConnectionExists(struct Curl_easy *data,
          (data->state.httpwant < CURL_HTTP_VERSION_2_0))
         continue;

+      if(get_protocol_family(needle->handler) & PROTO_FAMILY_SSH) {
+        if(!ssh_config_matches(needle, check))
+          continue;
+      }
+
       if((needle->handler->flags&PROTOPT_SSL)
 #ifndef CURL_DISABLE_PROXY
          || !needle->bits.httpproxy || needle->bits.tunnel_proxy
--
2.45.2
