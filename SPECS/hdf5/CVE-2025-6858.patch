From ff3d6722a91587daaaac82e78b25d26ad3f50172 Mon Sep 17 00:00:00 2001
From: Binh-Minh <bmribler@hdfgroup.org>
Date: Mon, 4 Aug 2025 03:10:29 -0400
Subject: [PATCH] Fix reading bad size in the raw header continuation message

This issue was reported in GH-5376 as a heap-use-after-free vulnerability in
one of the free lists.  It appeared that the library came to this vulnerability
after it encountered an undetected reading of a bad value.  The fuzzer now failed
with an appropriate error message.

This considers addressing what GH-5376 reported.
Upstream Patch Reference: https://patch-diff.githubusercontent.com/raw/HDFGroup/hdf5/pull/5710.patch
---
 src/H5Ocont.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/H5Ocont.c b/src/H5Ocont.c
index 180b115..44ef8b1 100644
--- a/src/H5Ocont.c
+++ b/src/H5Ocont.c
@@ -104,6 +104,9 @@ H5O__cont_decode(H5F_t *f, H5O_t H5_ATTR_UNUSED *open_oh, unsigned H5_ATTR_UNUSE
         HGOTO_ERROR(H5E_OHDR, H5E_OVERFLOW, NULL, "ran off end of input buffer while decoding");
     H5F_DECODE_LENGTH(f, p, cont->size);
 
+    if (cont->size == 0)
+        HGOTO_ERROR(H5E_OHDR, H5E_BADVALUE, NULL, "invalid continuation chunk size (0)");
+
     /* Set return value */
     ret_value = cont;
 
-- 
2.45.4

