From d1cbef8d9c0821c21cda593487f5fca6ec560758 Mon Sep 17 00:00:00 2001
From: "alexander.akait" <sheo13666q@gmail.com>
Date: Wed, 21 Aug 2024 15:47:34 +0300
Subject: [PATCH] security: fix DOM clobbering in auto public path

Upstream commit: 955e057abc6cc83cbc3fa1e1ef67a49758bf5a61
signoff by @xordux on 2024-09-02

---
 .../webpack/lib/runtime/AutoPublicPathRuntimeModule.js       | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/tb_tmp/b069b9e9814ff76ffa6219506d1f1e79/external/npm/_/node_modules/@angular/build-tooling/node_modules/webpack/lib/runtime/AutoPublicPathRuntimeModule.js b/tb_tmp/b069b9e9814ff76ffa6219506d1f1e79/external/npm/_/node_modules/@angular/build-tooling/node_modules/webpack/lib/runtime/AutoPublicPathRuntimeModule.js
index a67240862..18dc9c0fa 100644
--- a/tb_tmp/b069b9e9814ff76ffa6219506d1f1e79/external/npm/_/node_modules/@angular/build-tooling/node_modules/webpack/lib/runtime/AutoPublicPathRuntimeModule.js
+++ b/tb_tmp/b069b9e9814ff76ffa6219506d1f1e79/external/npm/_/node_modules/@angular/build-tooling/node_modules/webpack/lib/runtime/AutoPublicPathRuntimeModule.js
@@ -42,7 +42,10 @@ class AutoPublicPathRuntimeModule extends RuntimeModule {
 						`var document = ${RuntimeGlobals.global}.document;`,
 						"if (!scriptUrl && document) {",
 						Template.indent([
-							`if (document.currentScript)`,
+							// Technically we could use `document.currentScript instanceof window.HTMLScriptElement`,
+							// but an attacker could try to inject `<script>HTMLScriptElement = HTMLImageElement</script>`
+							// and use `<img name="currentScript" src="https://attacker.controlled.server/"></img>`
+							"if (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')",
 							Template.indent(`scriptUrl = document.currentScript.src`),
 							"if (!scriptUrl) {",
 							Template.indent([
-- 
2.39.4

