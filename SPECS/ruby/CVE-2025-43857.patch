From 607f55981c1c0a66346aaf0b439079eb23a93d87 Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Tue, 25 Nov 2025 04:51:22 +0000
Subject: [PATCH] Add ResponseTooLargeError and related classes to
 bundler/errors.rb as per backport patch

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/ruby/net-imap/pull/445.patch
---
 lib/bundler/errors.rb | 34 ++++++++++++++++++++++++++++++++++
 1 file changed, 34 insertions(+)

diff --git a/lib/bundler/errors.rb b/lib/bundler/errors.rb
index f10b6cc..bde9391 100644
--- a/lib/bundler/errors.rb
+++ b/lib/bundler/errors.rb
@@ -158,6 +158,40 @@ module Bundler
     end
 
     status_code(31)
+
+  # Error raised when the socket cannot be read, due to a Config limit.
+  class ResponseReadError < BundlerError
+  end
+
+  # Error raised when a response is larger than IMAP#max_response_size.
+  class ResponseTooLargeError < ResponseReadError
+    attr_reader :bytes_read, :literal_size
+    attr_reader :max_response_size
+
+    def initialize(msg = nil, *args,
+                   bytes_read:        nil,
+                   literal_size:      nil,
+                   max_response_size: nil,
+                   **kwargs)
+      @bytes_read        = bytes_read
+      @literal_size      = literal_size
+      @max_response_size = max_response_size
+      msg ||= [
+        "Response size", response_size_msg, "exceeds max_response_size",
+        max_response_size && "(#{max_response_size}B)",
+      ].compact.join(" ")
+      super(msg, *args, **kwargs)
+    end
+
+    private
+
+    def response_size_msg
+      if bytes_read && literal_size
+        "(#{bytes_read}B read + #{literal_size}B literal)"
+      end
+    end
+  end
+
   end
 
   class GenericSystemCallError < BundlerError
-- 
2.45.4

