From bb423ce7d5d1a7b8c111dc52a08020df0dc5bf67 Mon Sep 17 00:00:00 2001
From: Behdad Esfahbod <behdad@behdad.org>
Date: Fri, 9 Jan 2026 04:54:42 -0700
Subject: [PATCH] malloc fail test (#5710)

Fixes https://github.com/harfbuzz/harfbuzz/security/advisories/GHSA-xvjr-f2r9-c7ww

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: https://github.com/harfbuzz/harfbuzz/commit/1265ff8d990284f04d8768f35b0e20ae5f60daae.patch
---
 src/hb-ot-cmap-table.hh | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/hb-ot-cmap-table.hh b/src/hb-ot-cmap-table.hh
index e2e2581..2f7d727 100644
--- a/src/hb-ot-cmap-table.hh
+++ b/src/hb-ot-cmap-table.hh
@@ -1534,6 +1534,10 @@ struct SubtableUnicodesCache {
   {
     SubtableUnicodesCache* cache =
         (SubtableUnicodesCache*) hb_malloc (sizeof(SubtableUnicodesCache));
+
+    if (unlikely (!cache))
+      return nullptr;
+
     new (cache) SubtableUnicodesCache (source_table);
     return cache;
   }
-- 
2.45.4

