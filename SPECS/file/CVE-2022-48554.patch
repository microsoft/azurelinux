From 90d7e3a175210a1b9afc07b12e69e88e9e2092a7 Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Mon, 14 Feb 2022 16:26:10 +0000
Subject: [PATCH] PR/310: p870613: Don't use strlcpy to copy the string, it
 will try to scan the source string to find out how much space is needed the
 source string might not be NUL terminated.

Signed-off-by: Muhammad Falak R Wani <falakreyaz@gmail.com>
---
 src/funcs.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/src/funcs.c b/src/funcs.c
index b926625..d32e85b 100644
--- a/src/funcs.c
+++ b/src/funcs.c
@@ -54,9 +54,12 @@ FILE_RCSID("@(#)$File: funcs.c,v 1.121 2021/02/05 22:29:07 christos Exp $")
 protected char *
 file_copystr(char *buf, size_t blen, size_t width, const char *str)
 {
-	if (++width > blen)
-		width = blen;
-	strlcpy(buf, str, width);
+	if (blen == 0)
+		return buf;
+	if (width >= blen)
+		width = blen - 1;
+	memcpy(buf, str, width);
+	buf[width] = '\0';
 	return buf;
 }
 
-- 
2.40.1

