
This is one way to generate local self-signed cert(s) for use in testing.

1) Install required packages

$ sudo dnf install dnf-utils pesign nss-tools efivar rpmdevtools

2) Add your (non-root) user to the pesign group

$ sudo usermod -a -G pesign $(whoami)

You may need to logout and back in for the group addition to take effect.

3) Create local signing certificates for testing

$ dnf download --source pesign
$ mkdir pesign-files
$ rpmdev-extract -C pesign-files pesign-*.src.rpm
$ cd pesign-files/pesign-*.src
$ tar xvf pesign-*.tar.bz2
$ cd pesign-*/src/certs

4) Create a self-signed CA as well as a signing cert

Set KEY to whatever key name you want, e.g. KeyInShim, KeyInDB, etc.

You can create multiple keys by using a different KEY value and
re-running these steps, but you must not remove any of the files
generated by the make-certs script. Add the 'ca.crt' to your pesign
nss db only once.

$ export KEY=KeyInShim
$ ./make-certs $KEY azurelinux@microsoft.com all codesign 1.3.6.1.4.1.311.10.3.1
$ certutil -d /etc/pki/pesign -A -n 'my CA' -t CT,CT,CT -i ca.crt
$ pk12util -d /etc/pki/pesign -i $KEY.p12
$ certutil -d /etc/pki/pesign -A -i $KEY.crt -n $KEY -t u

