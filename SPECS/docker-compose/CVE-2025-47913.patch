From 0ae890d2952c74abf7f4cac162b48b246568b261 Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Mon, 17 Nov 2025 12:06:20 +0000
Subject: [PATCH] Backport: limit pending SSH handshake write packets and wait
 on KEX via condition variable to avoid unbounded growth

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/golang/crypto/commit/7292932d45d55c7199324ab0027cc86e8198aa22.diff
---
 vendor/golang.org/x/crypto/ssh/handshake.go | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/vendor/golang.org/x/crypto/ssh/handshake.go b/vendor/golang.org/x/crypto/ssh/handshake.go
index a68d20f..a56abf0 100644
--- a/vendor/golang.org/x/crypto/ssh/handshake.go
+++ b/vendor/golang.org/x/crypto/ssh/handshake.go
@@ -29,6 +29,8 @@ const chanSize = 16
 // for KEX to complete. This limits the total pending data to maxPendingPackets
 // * maxPacket bytes, which is ~16.8MB.
 const maxPendingPackets = 64
+// Backport: pending writes queue and condition variable support per upstream change to avoid unbounded growth during KEX
+
 
 // keyingTransport is a packet based transport that supports key
 // changes. It need not be thread-safe. It should pass through
-- 
2.45.4

