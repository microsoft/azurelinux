From 4bc70904d4e31b768f38c2b321c29a370c614497 Mon Sep 17 00:00:00 2001
From: Suneel Yadava <suneelyadava@microsoft.com>
Date: Mon, 23 Jun 2025 10:51:55 +0000
Subject: [PATCH] Fix for CVE-2025-6140
Upstream Patch Reference:
https://github.com/gabime/spdlog/commit/10320184df1eb4638e253a34b1eb44ce78954094

---
 deps/spdlog/include/spdlog/pattern_formatter-inl.h | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/deps/spdlog/include/spdlog/pattern_formatter-inl.h b/deps/spdlog/include/spdlog/pattern_formatter-inl.h
index 01afbe6..ee01489 100644
--- a/deps/spdlog/include/spdlog/pattern_formatter-inl.h
+++ b/deps/spdlog/include/spdlog/pattern_formatter-inl.h
@@ -76,6 +76,9 @@ public:
         else if (padinfo_.truncate_)
         {
             long new_size = static_cast<long>(dest_.size()) + remaining_pad_;
+            if (new_size < 0) {
+                new_size = 0;
+            }
             dest_.resize(static_cast<size_t>(new_size));
         }
     }
@@ -303,7 +306,7 @@ public:
 
     void format(const details::log_msg &, const std::tm &tm_time, memory_buf_t &dest) override
     {
-        const size_t field_size = 10;
+        const size_t field_size = 8;
         ScopedPadder p(field_size, padinfo_, dest);
 
         fmt_helper::pad2(tm_time.tm_mon + 1, dest);
-- 
2.45.3

