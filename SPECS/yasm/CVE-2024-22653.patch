From 9aee6978378817664714350b597073efabfdef12 Mon Sep 17 00:00:00 2001
From: archana25-ms <v-shettigara@microsoft.com>
Date: Mon, 23 Jun 2025 08:51:40 +0000
Subject: [PATCH] Address CVE-2024-22653
Upstream Patch Reference: https://patch-diff.githubusercontent.com/raw/yasm/yasm/pull/263.diff

---
 libyasm/section.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/libyasm/section.c b/libyasm/section.c
index ba582bf..1c1ba71 100644
--- a/libyasm/section.c
+++ b/libyasm/section.c
@@ -611,6 +611,10 @@ yasm_bytecode *
 yasm_section_bcs_append(yasm_section *sect, yasm_bytecode *bc)
 {
     if (bc) {
+        if (!sect) {
+            yasm_error_set(YASM_ERROR_VALUE, "Attempt to append bytecode to a NULL section or with a NULL bytecode");
+            return NULL;
+        }
         if (bc->callback) {
             bc->section = sect;     /* record parent section */
             STAILQ_INSERT_TAIL(&sect->bcs, bc, link);
-- 
2.45.3

