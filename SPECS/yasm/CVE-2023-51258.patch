From fd85453926e43073dc785ec0cc02a10fe2dd2794 Mon Sep 17 00:00:00 2001
From: akhila-guruju <v-guakhila@microsoft.com>
Date: Wed, 14 May 2025 07:13:01 +0000
Subject: [PATCH] Address CVE-2023-51258

Upstream patch reference: https://github.com/yasm/yasm/pull/264/commits/eeee94bfd6dd18af8b1508c1804d93cf20ef44e6

---
 modules/preprocs/nasm/nasm-pp.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/modules/preprocs/nasm/nasm-pp.c b/modules/preprocs/nasm/nasm-pp.c
index 27a8cc6..76df757 100644
--- a/modules/preprocs/nasm/nasm-pp.c
+++ b/modules/preprocs/nasm/nasm-pp.c
@@ -3091,6 +3091,7 @@ do_directive(Token * tline)
             {
                 error(ERR_NONFATAL, "`%s': not defining a macro",
                         tline->text);
+                free_tlist(origline);
                 return DIRECTIVE_FOUND;
             }
             k = hash(defining->name);
@@ -3188,6 +3189,7 @@ do_directive(Token * tline)
                 {
                     error(ERR_NONFATAL, "non-constant value given to `%%rep'");
                     yasm_expr_destroy(evalresult);
+                    free_tlist(origline);
                     return DIRECTIVE_FOUND;
                 }
                 i = (int)yasm_intnum_get_int(intn) + 1;
-- 
2.45.2

