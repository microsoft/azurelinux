From 735cd19c9df0aca080c864aa8be354b11241c987 Mon Sep 17 00:00:00 2001
From: Su_Laus <sulau@freenet.de>
Date: Fri, 8 Aug 2025 21:35:30 +0200
Subject: [PATCH] tiffcmp: fix memory leak when second file cannot be opened.

Closes #728, #729

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: https://gitlab.com/libtiff/libtiff/-/commit/ed141286a37f6e5ddafb5069347ff5d587e7a4e0.patch
---
 archive/tools/tiffcmp.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/archive/tools/tiffcmp.c b/archive/tools/tiffcmp.c
index 529c1cd..88d9470 100644
--- a/archive/tools/tiffcmp.c
+++ b/archive/tools/tiffcmp.c
@@ -105,7 +105,10 @@ int main(int argc, char *argv[])
         return (2);
     tif2 = TIFFOpen(argv[optind + 1], "r");
     if (tif2 == NULL)
+    {
+        TIFFClose(tif1);
         return (2);
+    }
     dirnum = 0;
     while (tiffcmp(tif1, tif2))
     {
-- 
2.45.4

