From 7ec6f53745ab6331382e59373ffd980b38a378f0 Mon Sep 17 00:00:00 2001
From: Lee Howard <faxguy@howardsilvan.com>
Date: Wed, 13 Mar 2024 10:06:21 -0700
Subject: [PATCH] fix tiffcrop issues #552, #550, and #542

---
 archive/tools/tiffcrop.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/archive/tools/tiffcrop.c b/archive/tools/tiffcrop.c
index 95983479c..3d837d269 100644
--- a/archive/tools/tiffcrop.c
+++ b/archive/tools/tiffcrop.c
@@ -7766,6 +7766,14 @@ static int extractImageSection(struct image_data *image,
         (sect_width * spp * bps) %
         8; /* trailing bits within the last byte of destination buffer */
 
+    /* Check to make sure that we've got enough buffer.
+     */
+    if ((last_row - first_row) * img_rowsize > full_bytes)
+    {
+        printf("The source image data is too small.\n");
+        return(-1);
+    }
+
 #ifdef DEVELMODE
     TIFFError("",
               "First row: %" PRIu32 ", last row: %" PRIu32
-- 

