From 3c1445d537218a0678927dfbca54178b13062080 Mon Sep 17 00:00:00 2001
From: Hugo Muis <198191869+friendlyhugo@users.noreply.github.com>
Date: Sun, 2 Mar 2025 18:06:24 +0100
Subject: [PATCH] core: fix DoS bug by changing assert to return

Closes https://github.com/avahi/avahi/issues/678

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: https://github.com/avahi/avahi/pull/682/commits/9c6eb53bf2e290aed84b1f207e3ce35c54cc0aa1.patch
---
 avahi-core/browse.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/avahi-core/browse.c b/avahi-core/browse.c
index 2966f95..1cf0ee3 100644
--- a/avahi-core/browse.c
+++ b/avahi-core/browse.c
@@ -319,7 +319,10 @@ static int lookup_start(AvahiSRBLookup *l) {
     assert(l);
 
     assert(!(l->flags & AVAHI_LOOKUP_USE_WIDE_AREA) != !(l->flags & AVAHI_LOOKUP_USE_MULTICAST));
-    assert(!l->wide_area && !l->multicast);
+    if (l->wide_area || l->multicast) {
+        /* Avoid starting a duplicate lookup */
+        return 0;
+    }
 
     if (l->flags & AVAHI_LOOKUP_USE_WIDE_AREA) {
 
-- 
2.45.4

