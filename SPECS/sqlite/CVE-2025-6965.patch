From 21fd260b719da5aa881c760f2d11997ec0d7d28a Mon Sep 17 00:00:00 2001
From: Kshitiz Godara <kgodara@microsoft.com>
Date: Mon, 4 Aug 2025 06:48:07 +0000
Subject: [PATCH 2/2] Fix for CVE-2025-6965 [HIGH]

Upstream reference:
https://www.sqlite.org/src/info/642be27a38018649
---
 sqlite3.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/sqlite3.c b/sqlite3.c
index 70c9b45..003961a 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -109837,7 +109837,7 @@ static int analyzeAggregate(Walker *pWalker, Expr *pExpr){
             ExprSetVVAProperty(pExpr, EP_NoReduce);
             pExpr->pAggInfo = pAggInfo;
             pExpr->op = TK_AGG_COLUMN;
-            pExpr->iAgg = (i16)k;
+            pExpr->iAgg = (i16)(k&0x7fff);
             break;
           } /* endif pExpr->iTable==pItem->iCursor */
         } /* end loop over pSrcList */
@@ -109883,7 +109883,7 @@ static int analyzeAggregate(Walker *pWalker, Expr *pExpr){
         */
         assert( !ExprHasProperty(pExpr, EP_TokenOnly|EP_Reduced) );
         ExprSetVVAProperty(pExpr, EP_NoReduce);
-        pExpr->iAgg = (i16)i;
+        pExpr->iAgg = (i16)(i&0x7fff);
         pExpr->pAggInfo = pAggInfo;
         return WRC_Prune;
       }else{
-- 
2.45.4

