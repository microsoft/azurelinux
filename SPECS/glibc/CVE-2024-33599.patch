From 6c94f0bd6bf27f03927e66f2d93df731090c6ce6 Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Fri, 27 Jun 2025 09:56:34 +0000
Subject: [PATCH] Fix CVE CVE-2024-33599 in glibc

Upstream Patch Reference: https://github.com/bminor/glibc/commit/5968aebb86164034b8f8421b4abab2f837a5bdaf.patch
---
 glibc-2.38/nscd/netgroupcache.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/glibc-2.38/nscd/netgroupcache.c b/glibc-2.38/nscd/netgroupcache.c
index 06b7d7b..31b721b 100644
--- a/glibc-2.38/nscd/netgroupcache.c
+++ b/glibc-2.38/nscd/netgroupcache.c
@@ -502,12 +502,13 @@ addinnetgrX (struct database_dyn *db, int fd, request_header *req,
       = (struct indataset *) mempool_alloc (db,
 					    sizeof (*dataset) + req->key_len,
 					    1);
-  struct indataset dataset_mem;
   bool cacheable = true;
   if (__glibc_unlikely (dataset == NULL))
     {
       cacheable = false;
-      dataset = &dataset_mem;
+      /* The alloca is safe because nscd_run_worker verfies that
+	 key_len is not larger than MAXKEYLEN.  */
+      dataset = alloca (sizeof (*dataset) + req->key_len);
     }
 
   datahead_init_pos (&dataset->head, sizeof (*dataset) + req->key_len,
-- 
2.45.3

