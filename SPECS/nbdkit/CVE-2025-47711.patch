From 474c0df27522beb33db2822e1478bdac946e2cb2 Mon Sep 17 00:00:00 2001
From: AkarshHCL <v-akarshc@microsoft.com>
Date: Thu, 19 Jun 2025 12:47:53 +0000
Subject: [PATCH] Address CVE-2025-47711.patch

Upstream Patch reference:https://gitlab.com/nbdkit/nbdkit/-/commit/c3c1950867ea8d9c2108ff066ed9e78dde3cfc3f

---
 server/protocol.c | 2 +-
 tests/Makefile.am | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/server/protocol.c b/server/protocol.c
index d9a5e28..c32fec8 100644
--- a/server/protocol.c
+++ b/server/protocol.c
@@ -493,7 +493,7 @@ extents_to_block_descriptors (struct nbdkit_extents *extents,
       (*nr_blocks)++;
 
       pos += length;
-      if (pos > offset + count) /* this must be the last block */
+      if (pos >= offset + count) /* this must be the last block */
         break;
 
       /* If we reach here then we must have consumed this whole
diff --git a/tests/Makefile.am b/tests/Makefile.am
index 429ba11..dae753f 100644
--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -789,6 +789,7 @@ EXTRA_DIST += \
 	test-eval.sh \
 	test-eval-file.sh \
 	test-eval-exports.sh \
+	test-eval-extents.sh \
 	test-eval-cache.sh \
 	test-eval-dump-plugin.sh \
 	test-eval-disconnect.sh \
-- 
2.45.2

