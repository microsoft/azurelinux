From dcf8726020de572e28ae4f9b0b40be2a6ea27a2c Mon Sep 17 00:00:00 2001
From: Kevin Lockwood <v-klockwood@microsoft.com>
Date: Mon, 23 Jun 2025 14:21:55 -0700
Subject: [PATCH] Patch xorg-x11-server-Xwayland for CVE-2025-49179

Upstream Patch Link: https://gitlab.freedesktop.org/xorg/xserver/-/commit/2bde9ca49a8fd9a1e6697d5e7ef837870d66f5d4.patch

Part-of: <https://gitlab.freedesktop.org/xorg/xserver/-/merge_requests/2024>
---
 record/record.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/record/record.c b/record/record.c
index ca9254c..311ec1a 100644
--- a/record/record.c
+++ b/record/record.c
@@ -46,6 +46,7 @@ and Jim Haggerty of Metheus.
 #include "swaprep.h"
 #include "inputstr.h"
 #include "scrnintstr.h"
+#include "include/opaque.h"
 
 #include <stdio.h>
 #include <assert.h>
@@ -1299,6 +1300,13 @@ RecordSanityCheckRegisterClients(RecordContextPtr pContext, ClientPtr client,
     int i;
     XID recordingClient;
 
+    /* LimitClients is 2048 at max, way less that MAXINT */
+    if (stuff->nClients > LimitClients)
+        return BadValue;
+
+    if (stuff->nRanges > (MAXINT - 4 * stuff->nClients) / SIZEOF(xRecordRange))
+        return BadValue;
+
     if (((client->req_len << 2) - SIZEOF(xRecordRegisterClientsReq)) !=
         4 * stuff->nClients + SIZEOF(xRecordRange) * stuff->nRanges)
         return BadLength;
-- 
2.34.1

