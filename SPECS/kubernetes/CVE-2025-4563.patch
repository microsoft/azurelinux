From c7ef08e0fd2763ba2a47485f7f514dfbf6802e6e Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Mon, 30 Jun 2025 11:37:38 +0000
Subject: [PATCH] Fix CVE CVE-2025-4563 in kubernetes

Upstream Patch Reference: https://github.com/kubernetes/kubernetes/commit/1fde2b884c7110c5e253db7143b24bfd91202c4d.patch
---
 pkg/kubelet/config/common.go | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/pkg/kubelet/config/common.go b/pkg/kubelet/config/common.go
index 69d6712..a73d637 100644
--- a/pkg/kubelet/config/common.go
+++ b/pkg/kubelet/config/common.go
@@ -106,6 +106,9 @@ type defaultFunc func(pod *api.Pod) error
 // A static pod tried to use a ClusterTrustBundle projected volume source.
 var ErrStaticPodTriedToUseClusterTrustBundle = errors.New("static pods may not use ClusterTrustBundle projected volume sources")
 
+// A static pod tried to use a resource claim.
+var ErrStaticPodTriedToUseResourceClaims = errors.New("static pods may not use ResourceClaims")
+
 // tryDecodeSinglePod takes data and tries to extract valid Pod config information from it.
 func tryDecodeSinglePod(data []byte, defaultFn defaultFunc) (parsed bool, pod *v1.Pod, err error) {
 	// JSON is valid YAML, so this should work for everything.
@@ -152,6 +155,9 @@ func tryDecodeSinglePod(data []byte, defaultFn defaultFunc) (parsed bool, pod *v
 			}
 		}
 	}
+	if len(v1Pod.Spec.ResourceClaims) > 0 {
+		return true, nil, ErrStaticPodTriedToUseResourceClaims
+	}
 
 	return true, v1Pod, nil
 }
-- 
2.45.3

