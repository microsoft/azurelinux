From 8f1fe08acc9aee7aa86007d288096e9056cafb83 Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Fri, 31 Oct 2025 19:35:07 +0000
Subject: [PATCH] Promote OrderedNamespaceDeletion to GA and lock to default;
 update e2e import order to include pkg/features per patch

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/kubernetes/kubernetes/pull/131514/commits/eb3c9a3184aabf89405f05fafb6f2bf91ba92226.patch
---
 pkg/features/kube_features.go      | 9 +++++++++
 test/e2e/apimachinery/namespace.go | 3 ++-
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/pkg/features/kube_features.go b/pkg/features/kube_features.go
index 86d13691..4070172c 100644
--- a/pkg/features/kube_features.go
+++ b/pkg/features/kube_features.go
@@ -563,6 +563,11 @@ const (
 	// Permits kubelet to run with swap enabled.
 	NodeSwap featuregate.Feature = "NodeSwap"
 
+
+	// owner: @? backport
+	// Promote OrderedNamespaceDeletion to GA
+	OrderedNamespaceDeletion featuregate.Feature = "OrderedNamespaceDeletion"
+
 	// owner: @mortent, @atiratree, @ravig
 	// kep: http://kep.k8s.io/3018
 	// alpha: v1.26
@@ -1145,6 +1150,10 @@ var defaultKubernetesFeatureGates = map[featuregate.Feature]featuregate.FeatureS
 
 	NodeLogQuery: {Default: false, PreRelease: featuregate.Beta},
 
+	// OrderedNamespaceDeletion promoted to GA in 1.34 and locked to default
+	OrderedNamespaceDeletion: {Default: true, PreRelease: featuregate.GA, LockToDefault: true},
+
+
 	NodeOutOfServiceVolumeDetach: {Default: true, PreRelease: featuregate.GA, LockToDefault: true}, // remove in 1.31
 
 	NodeSwap: {Default: true, PreRelease: featuregate.Beta},
diff --git a/test/e2e/apimachinery/namespace.go b/test/e2e/apimachinery/namespace.go
index 121f4be1..1e948fd0 100644
--- a/test/e2e/apimachinery/namespace.go
+++ b/test/e2e/apimachinery/namespace.go
@@ -34,6 +34,8 @@ import (
 	utilrand "k8s.io/apimachinery/pkg/util/rand"
 	"k8s.io/apimachinery/pkg/util/uuid"
 	"k8s.io/apimachinery/pkg/util/wait"
+	"k8s.io/kubernetes/pkg/features"
+
 	clientscheme "k8s.io/client-go/kubernetes/scheme"
 	"k8s.io/client-go/util/retry"
 	"k8s.io/kubernetes/test/e2e/feature"
@@ -45,7 +47,6 @@ import (
 	"github.com/onsi/ginkgo/v2"
 	"github.com/onsi/gomega"
 )
-
 func extinguish(ctx context.Context, f *framework.Framework, totalNS int, maxAllowedAfterDel int, maxSeconds int) {
 	ginkgo.By("Creating testing namespaces")
 	wg := &sync.WaitGroup{}
-- 
2.45.4

