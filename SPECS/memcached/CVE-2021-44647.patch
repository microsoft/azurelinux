From f77d11035ab9d0907bfe949752b156986beb8c01 Mon Sep 17 00:00:00 2001
From: jykanase <v-jykanase@microsoft.com>
Date: Thu, 20 Mar 2025 08:54:32 +0000
Subject: [PATCH] CVE-2021-44647

Source Link : https://github.com/lua/lua/commit/1de95e97ef65632a88e08b6184bd9d1ceba7ec2f
---
 vendor/lua/src/lstate.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/vendor/lua/src/lstate.c b/vendor/lua/src/lstate.c
index a887005..db24cf6 100644
--- a/vendor/lua/src/lstate.c
+++ b/vendor/lua/src/lstate.c
@@ -270,6 +270,7 @@ static void close_state (lua_State *L) {
   if (!completestate(g))  /* closing a partially built state? */
     luaC_freeallobjects(L);  /* jucst collect its objects */
   else {  /* closing a fully built state */
+    L->ci = &L->base_ci;  /* unwind CallInfo list */
     luaD_closeprotected(L, 1, LUA_OK);  /* close all upvalues */
     luaC_freeallobjects(L);  /* collect all objects */
     luai_userstateclose(L);
-- 
2.45.2

