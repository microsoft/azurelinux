From 35b1514eba18a239c85867ab4132408d85e1e120 Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Thu, 17 Jul 2025 08:48:22 +0000
Subject: [PATCH] Fix CVE CVE-2025-7546 in binutils

Upstream Patch Reference: https://github.com/bminor/binutils-gdb/commit/41461010eb7c79fee7a9d5f6209accdaac66cc6b.patch
---
 bfd/elf.c | 23 ++++++++++-------------
 1 file changed, 10 insertions(+), 13 deletions(-)

diff --git a/bfd/elf.c b/bfd/elf.c
index d38e0aff..1de0cec0 100644
--- a/bfd/elf.c
+++ b/bfd/elf.c
@@ -4120,20 +4120,17 @@ bfd_elf_set_group_contents (bfd *abfd, asection *sec, void *failedptrarg)
 	break;
     }
 
-  /* We should always get here with loc == sec->contents + 4, but it is
-     possible to craft bogus SHT_GROUP sections that will cause segfaults
-     in objcopy without checking loc here and in the loop above.  */
-  if (loc == sec->contents)
-    BFD_ASSERT (0);
-  else
+  /* We should always get here with loc == sec->contents + 4.  Return
+     an error for bogus SHT_GROUP sections.  */
+  loc -= 4;
+  if (loc != sec->contents)
     {
-      loc -= 4;
-      if (loc != sec->contents)
-	{
-	  BFD_ASSERT (0);
-	  memset (sec->contents + 4, 0, loc - sec->contents);
-	  loc = sec->contents;
-	}
+      /* xgettext:c-format */
+      _bfd_error_handler (_("%pB: corrupted group section: `%pA'"),
+			  abfd, sec);
+      bfd_set_error (bfd_error_bad_value);
+      *failedptr = true;
+      return;
     }
 
   H_PUT_32 (abfd, sec->flags & SEC_LINK_ONCE ? GRP_COMDAT : 0, loc);
-- 
2.45.3

