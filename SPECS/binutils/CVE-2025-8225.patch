From 615a0496206ed16a93f3362d6189bdf8ba7c3523 Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Mon, 28 Jul 2025 19:39:05 +0000
Subject: [PATCH] Fix CVE CVE-2025-8225 in binutils

[AI Backported] Upstream Patch Reference: https://gitlab.com/gnutools/binutils-gdb/-/commit/e51fdff7d2e538c0e5accdd65649ac68e6e0ddd4
(Revised by <v-klockwood@microsoft.com>)
---
 binutils/dwarf.c | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)

diff --git a/binutils/dwarf.c b/binutils/dwarf.c
index d976a64b..7934b2b5 100644
--- a/binutils/dwarf.c
+++ b/binutils/dwarf.c
@@ -3480,14 +3480,12 @@ process_debug_info (struct dwarf_section * section,
       return false;
     }
 
-  if ((do_loc || do_debug_loc || do_debug_ranges)
-      && num_debug_info_entries == 0
-      && ! do_types)
+  if ((do_loc || do_debug_loc || do_debug_ranges || do_debug_info)
+      && alloc_num_debug_info_entries == 0
+      && !do_types)
     {
-
       /* Then allocate an array to hold the information.  */
-      debug_information = (debug_info *) cmalloc (num_units,
-						  sizeof (* debug_information));
+      debug_information = cmalloc (num_units, sizeof (*debug_information));
       if (debug_information == NULL)
 	{
 	  error (_("Not enough memory for a debug info array of %u entries\n"),
-- 
2.45.4

