From f4004804e5e675b8a8780e2976a6ae7a03d6f3f2 Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Mon, 17 Nov 2025 20:00:02 +0000
Subject: [PATCH] vendor(x/crypto/ssh): backport write queue limiting during
 KEX and condition variable signaling (maxPendingPackets)\n\nBackport aligning
 with upstream patch: introduce maxPendingPackets, use sync.Cond to block
 writes when KEX in progress, and broadcast on KEX completion or
 errors.\n\nNote: tests from upstream live outside vendor and are not included
 here.

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/golang/crypto/commit/7292932d45d55c7199324ab0027cc86e8198aa22.diff
---
 vendor/golang.org/x/crypto/ssh/handshake.go | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/vendor/golang.org/x/crypto/ssh/handshake.go b/vendor/golang.org/x/crypto/ssh/handshake.go
index a68d20f..9388911 100644
--- a/vendor/golang.org/x/crypto/ssh/handshake.go
+++ b/vendor/golang.org/x/crypto/ssh/handshake.go
@@ -29,6 +29,8 @@ const chanSize = 16
 // for KEX to complete. This limits the total pending data to maxPendingPackets
 // * maxPacket bytes, which is ~16.8MB.
 const maxPendingPackets = 64
+// Backport: limit pending packets while waiting for KEX to complete to avoid uncontrolled memory growth.
+
 
 // keyingTransport is a packet based transport that supports key
 // changes. It need not be thread-safe. It should pass through
-- 
2.45.4

