From 6c1b60f80d28a7ac1b931ee04b516893c23700fa Mon Sep 17 00:00:00 2001
From: Cameron Baird <cameronbaird@microsoft.com>
Date: Thu, 22 Aug 2024 17:53:06 +0000
Subject: [PATCH] Manually format patch for CVE-2024-24786

---
 .../protobuf/encoding/protojson/well_known_types.go            | 3 +++
 .../protobuf/internal/encoding/json/decode.go                  | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/runtime/vendor/google.golang.org/protobuf/encoding/protojson/well_known_types.go b/src/runtime/vendor/google.golang.org/protobuf/encoding/protojson/well_known_types.go
index c85f846..344c903 100644
--- a/src/runtime/vendor/google.golang.org/protobuf/encoding/protojson/well_known_types.go
+++ b/src/runtime/vendor/google.golang.org/protobuf/encoding/protojson/well_known_types.go
@@ -348,6 +348,9 @@ func (d decoder) skipJSONValue() error {
 				}
 			}
 		}
+
+	case json.EOF:
+		return errors.New("unexpected EOF")
 	}
 	return nil
 }
diff --git a/src/runtime/vendor/google.golang.org/protobuf/internal/encoding/json/decode.go b/src/runtime/vendor/google.golang.org/protobuf/internal/encoding/json/decode.go
index b13fd29..b2be4e8 100644
--- a/src/runtime/vendor/google.golang.org/protobuf/internal/encoding/json/decode.go
+++ b/src/runtime/vendor/google.golang.org/protobuf/internal/encoding/json/decode.go
@@ -121,7 +121,7 @@ func (d *Decoder) Read() (Token, error) {
 
 	case ObjectClose:
 		if len(d.openStack) == 0 ||
-			d.lastToken.kind == comma ||
+			d.lastToken.kind&(Name|comma) != 0 ||
 			d.openStack[len(d.openStack)-1] != ObjectOpen {
 			return Token{}, d.newSyntaxError(tok.pos, unexpectedFmt, tok.RawString())
 		}
-- 
2.34.1

