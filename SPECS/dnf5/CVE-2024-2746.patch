From bcfab027e11f7349a1c221ac9298e6d79eedfaac Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Mon, 18 Aug 2025 06:26:26 +0000
Subject: [PATCH] dnf5daemon: Remove reposdir from allowed config overrides

The option is potentially dangerous and can cause dnf5daemon-server to
block on malicious reposdir.

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream Patch Reference: AI Backport of https://github.com/rpm-software-management/dnf5/commit/6e51bf2f0d585ab661806076c1e428c6482ddf86.patch:
---
 dnf5daemon-server/session.cpp | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/dnf5daemon-server/session.cpp b/dnf5daemon-server/session.cpp
index 8e86723..b5e4b7e 100644
--- a/dnf5daemon-server/session.cpp
+++ b/dnf5daemon-server/session.cpp
@@ -61,6 +61,12 @@ Session::Session(
     for (auto & opt : conf_overrides) {
         auto key = opt.first;
         auto value = opt.second;
+        // The 'reposdir' override is potentially dangerous and can cause dnf5daemon-server to block on malicious reposdir.
+        // Do not allow overriding 'reposdir' via session configuration.
+        if (key == "reposdir") {
+            base->get_logger()->warning("Config option 'reposdir' override is not allowed.");
+            continue;
+        }
         auto bind = opt_binds.find(key);
         if (bind != opt_binds.end()) {
             bind->second.new_string(libdnf::Option::Priority::RUNTIME, value);
-- 
2.45.4

