From 4c1a24d4494156007879399032bfe551d78c1932 Mon Sep 17 00:00:00 2001
From: jykanase <v-jykanase@microsoft.com>
Date: Thu, 6 Feb 2025 07:11:57 +0000
Subject: [PATCH] CVE-2021-44647

Source Link: https://github.com/lua/lua/commit/1de95e97ef65632a88e08b6184bd9d1ceba7ec2f
---
 third-party/lua-5.4.3/src/lstate.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/third-party/lua-5.4.3/src/lstate.c b/third-party/lua-5.4.3/src/lstate.c
index c5e3b43..38da773 100644
--- a/third-party/lua-5.4.3/src/lstate.c
+++ b/third-party/lua-5.4.3/src/lstate.c
@@ -271,6 +271,7 @@ static void close_state (lua_State *L) {
   if (!completestate(g))  /* closing a partially built state? */
     luaC_freeallobjects(L);  /* jucst collect its objects */
   else {  /* closing a fully built state */
+    L->ci = &L->base_ci;  /* unwind CallInfo list */
     luaD_closeprotected(L, 1, LUA_OK);  /* close all upvalues */
     luaC_freeallobjects(L);  /* collect all objects */
     luai_userstateclose(L);
-- 
2.45.2

