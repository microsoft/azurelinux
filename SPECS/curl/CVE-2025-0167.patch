From 9ef089b45f439bc1885ab7ee3e074ecc86a8bfcc Mon Sep 17 00:00:00 2001
From: Sreenivasulu Malavathula <v-smalavathu@microsoft.com>
Date: Fri, 28 Mar 2025 18:08:43 -0500
Subject: [PATCH] Address CVE-2025-0167
Upstream Patch Reference: https://github.com/curl/curl/commit/0e120c5b925e8ca75d5319e

---
 lib/netrc.c | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/lib/netrc.c b/lib/netrc.c
index 64efdc0..6053fa6 100644
--- a/lib/netrc.c
+++ b/lib/netrc.c
@@ -263,11 +263,17 @@ static int parsenetrc(const char *host,
 
 out:
     Curl_dyn_free(&buf);
-    if(!retcode && !password && our_login) {
-      /* success without a password, set a blank one */
-      password = strdup("");
-      if(!password)
-        retcode = 1; /* out of memory */
+    if(!retcode) {
+      if(!password && our_login) {
+        /* success without a password, set a blank one */
+        password = strdup("");
+        if(!password)
+          retcode = 1; /* out of memory */
+      }
+      else if(!login && !password) {
+        /* a default with no credentials */
+        retcode = NETRC_FILE_MISSING;
+      }
     }
     if(!retcode) {
       /* success */
-- 
2.45.2

