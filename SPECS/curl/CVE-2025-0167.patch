From eb239c24ea6ab8d2f1f3190572cdc6b646341cb0 Mon Sep 17 00:00:00 2001
From: Kanishk-Bansal <kbkanishk975@gmail.com>
Date: Thu, 13 Feb 2025 19:53:56 +0000
Subject: [PATCH] CVE-2025-0167
Upstream source: https://github.com/curl/curl/commit/0e120c5b925e8ca75d5319e
---
 lib/netrc.c | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/lib/netrc.c b/lib/netrc.c
index d5ee3c0..b5002fb 100644
--- a/lib/netrc.c
+++ b/lib/netrc.c
@@ -309,11 +309,16 @@ static int parsenetrc(struct store_netrc *store,
 
 out:
   Curl_dyn_free(&token);
-  if(!retcode && !password && our_login) {
-    /* success without a password, set a blank one */
-    password = strdup("");
-    if(!password)
-      retcode = 1; /* out of memory */
+  if(!retcode) {
+    if(!password && our_login) {
+      /* success without a password, set a blank one */
+      password = strdup("");
+      if(!password)
+        retcode = 1; /* out of memory */
+    }
+    else if(!login && !password)
+      /* a default with no credentials */
+      retcode = NETRC_FILE_MISSING;
   }
   if(!retcode) {
     /* success */
-- 
2.45.2

