From d453c87411089b77fc44bbca687c99d9e3dc2ccf Mon Sep 17 00:00:00 2001
From: Nick Samson <nisamson@microsoft.com>
Date: Mon, 1 Jul 2024 14:23:11 -0700
Subject: [PATCH] Patch CVE-2024-24806

---
 deps/libuv/src/idna.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/deps/libuv/src/idna.c b/deps/libuv/src/idna.c
index 93d982ca..7f0101c5 100644
--- a/deps/libuv/src/idna.c
+++ b/deps/libuv/src/idna.c
@@ -274,6 +274,9 @@ long uv__idna_toascii(const char* s, const char* se, char* d, char* de) {
   char* ds;
   int rc;
 
+  if (s == se)
+    return UV_EINVAL;
+
   ds = d;
 
   si = s;
@@ -308,8 +311,10 @@ long uv__idna_toascii(const char* s, const char* se, char* d, char* de) {
       return rc;
   }
 
-  if (d < de)
-    *d++ = '\0';
+  if (d >= de)
+    return UV_EINVAL;
+
+  *d++ = '\0';
 
   return d - ds;  /* Number of bytes written. */
 }
-- 
2.34.1

