From 0c7986153dbeacafdbe04e5c501c14c05a55d72b Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Mon, 26 Jan 2026 19:59:08 +0000
Subject: [PATCH] Verify threshold is valid (#712)

Verify threshold is valid by ensuring role threshold is at least 1 in VerifyDelegate.

Signed-off-by: Fredrik Skogman <kommendorkapten@github.com>
Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: AI Backport of https://github.com/theupdateframework/go-tuf/commit/b38d91fdbc69dfe31fe9230d97dafe527ea854a0.patch
---
 .../theupdateframework/go-tuf/v2/metadata/metadata.go      | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/vendor/github.com/theupdateframework/go-tuf/v2/metadata/metadata.go b/vendor/github.com/theupdateframework/go-tuf/v2/metadata/metadata.go
index 6d9fbc5..980c7ff 100644
--- a/vendor/github.com/theupdateframework/go-tuf/v2/metadata/metadata.go
+++ b/vendor/github.com/theupdateframework/go-tuf/v2/metadata/metadata.go
@@ -296,6 +296,13 @@ func (meta *Metadata[T]) VerifyDelegate(delegatedRole string, delegatedMetadata
 	if len(roleKeyIDs) == 0 {
 		return &ErrValue{Msg: fmt.Sprintf("no delegation found for %s", delegatedRole)}
 	}
+	// verify threshold should be at least 1
+	if roleThreshold < 1 {
+		return &ErrValue{Msg: fmt.Sprintf("insufficient threshold (%d) configured for %s",
+			roleThreshold,
+			delegatedRole)}
+	}
+
 	// loop through each role keyID
 	for _, keyID := range roleKeyIDs {
 		key, ok := keys[keyID]
-- 
2.45.4

