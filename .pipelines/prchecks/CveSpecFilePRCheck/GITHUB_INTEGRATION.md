# GitHub Integration for Azure Linux Spec PR Checks

This document explains how to utilize the GitHub integration features in the Azure Linux Spec PR Check system.

## Overview

The PR check system supports two types of GitHub integration:

1. **Multi-Level Status Notifications**: Nuanced status reporting using GitHub's status API
2. **PR Comments**: Detailed analysis and recommendations posted as comments on the PR

These features allow PR authors to see detailed feedback directly on GitHub without needing to access the Azure DevOps logs.

## Status Notification Levels

The system supports four levels of notification on GitHub, each with its own visual indicator:

| Level | GitHub UI | Can Merge? | Description |
|-------|-----------|------------|-------------|
| SUCCESS | ✅ Green checkmark | Yes | All checks passed |
| INFO | ✅ Green checkmark with note | Yes | Informational issues detected |
| WARNING | ⚠️ Yellow warning | Yes* | Warnings detected |
| ERROR/CRITICAL | ❌ Red X | No | Errors or critical issues detected |

\* Warnings will allow merging by default but can be configured to block merging with `--fail-on-warnings`

## PR Comments

When enabled, the system will post a comment on the PR with:

- A summary of detected issues grouped by severity
- Specific recommendations for fixing each issue
- A truncated version of the AI analysis (full analysis remains in ADO logs)

Comments are automatically updated on subsequent runs rather than creating duplicate comments.

## How to Enable

### In Azure DevOps Pipeline

Add the following parameters to your pipeline YAML:

```yaml
parameters:
  - name: postGitHubComments
    displayName: 'Post GitHub Comments'
    type: boolean
    default: true
  
  - name: useGitHubChecks
    displayName: 'Use GitHub Checks API'
    type: boolean
    default: true

steps:
- task: Bash@3
  displayName: 'Run CVE Spec File PR Check'
  inputs:
    targetType: 'inline'
    script: |
      cd $(Build.SourcesDirectory)/.pipelines/prchecks/CveSpecFilePRCheck
      ./run-pr-check.sh \
        --exit-code-severity \
        $(if eq(${{ parameters.postGitHubComments }}, true))'--post-github-comments' else '') \
        $(if eq(${{ parameters.useGitHubChecks }}, true))'--use-github-checks' else '')
  env:
    GITHUB_ACCESS_TOKEN: $(GitHubToken)
```

### Required Environment Variables

The following environment variables must be set for GitHub integration:

| Variable | Description | 
|----------|-------------|
| GITHUB_ACCESS_TOKEN | Personal Access Token with repo:status and repo permissions |
| GITHUB_REPOSITORY | Repository in format `owner/repo` (will be auto-extracted from ADO variables) |
| GITHUB_PR_NUMBER | PR number (will be auto-extracted from ADO variables) |

### Command-Line Arguments

For local testing or manual runs, use these arguments:

```bash
./run-pr-check.sh --post-github-comments --use-github-checks
```

## Examples

### Success Status with No Issues

![Success Status](https://example.com/path/to/success-status.png)

Success comment example:
```
## ✅ VALIDATION SUCCESSFUL

No issues were detected in the spec files.

---
*This comment was automatically generated by the Azure Linux PR Check system. See ADO pipeline logs for full details.*
```

### Warning Status

![Warning Status](https://example.com/path/to/warning-status.png)

Warning comment example:
```
## ⚠️ WARNINGS DETECTED

Review recommended, but PR can still be merged.

### ⚠️ Warnings

- **Unused Patch File**: Patch file 'sample.patch' exists in directory but is not referenced in spec
  - **Fix**: Add a reference to the patch file or remove it if not needed

---
*This comment was automatically generated by the Azure Linux PR Check system. See ADO pipeline logs for full details.*
```

### Error Status

![Error Status](https://example.com/path/to/error-status.png)

Error comment example:
```
## ❌ ERRORS DETECTED

These issues **must be fixed** before the PR can be merged.

### ❌ Errors

- **Missing Patch File**: Patch file 'CVE-2023-12345.patch' is referenced in the spec but not found in the directory
  - **Fix**: Add the missing patch file or update the Patch reference

---
*This comment was automatically generated by the Azure Linux PR Check system. See ADO pipeline logs for full details.*
```